package com.abn.simpleweather;
import android.app.Activity;
import android.os.Bundle;
import android.webkit.WebView;
import android.webkit.WebSettings;
import android.webkit.WebViewClient;
import android.util.Base64;
import android.view.WindowManager;
import android.os.Build;

public class MainActivity extends Activity {
    String html = "<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\"><title>NWS OLED Weather</title><script src=\"https://unpkg.com/htmx.org@1.9.10\"></script><style>:root { --bg-oled: #000000; --glass-surface: rgba(30, 30, 30, 0.4); --glass-border: rgba(255, 255, 255, 0.15); --text-bright: #ffffff; --text-mid: #b0b0b0; --text-dim: #666666; } * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; } body { background-color: var(--bg-oled); color: var(--text-bright); font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif; margin: 0; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); min-height: 100vh; display: flex; flex-direction: column; align-items: center; } .app-container { width: 100%; max-width: 700px; padding: 20px; display: flex; flex-direction: column; gap: 20px; } .glass-panel { background: var(--glass-surface); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); } header { text-align: center; padding: 10px 0 20px 0; } h1 { font-weight: 200; letter-spacing: 3px; text-transform: uppercase; font-size: 1rem; margin: 0; color: var(--text-mid); } .search-box { position: relative; margin-top: 15px; display: flex; gap: 10px; } input { flex: 1; background: #111; border: 1px solid var(--glass-border); color: #fff; padding: 14px 16px; border-radius: 12px; font-size: 16px; outline: none; } button.go-btn { background: var(--text-bright); color: #000; border: none; padding: 0 24px; border-radius: 12px; font-weight: 700; cursor: pointer; } #location-info { text-align: center; padding-bottom: 10px; border-bottom: 1px solid var(--glass-border); margin-bottom: 15px; } .city-name { font-size: 1.5rem; font-weight: 500; margin-bottom: 4px; } .coords { font-family: monospace; color: var(--text-dim); font-size: 0.8rem; } .tabs { display: flex; background: #111; border-radius: 12px; padding: 4px; margin-bottom: 20px; } .tab { flex: 1; text-align: center; padding: 10px; font-size: 0.8rem; color: var(--text-mid); border-radius: 8px; cursor: pointer; } .tab.active { background: var(--glass-border); color: #fff; font-weight: 600; } .weather-list { display: flex; flex-direction: column; gap: 12px; } .card { background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 16px; padding: 16px; cursor: pointer; } .card-header { display: grid; grid-template-columns: 1fr 40px 1fr; align-items: center; gap: 10px; } .time-group { display: flex; flex-direction: column; } .time-main { font-size: 1.1rem; font-weight: 600; } .time-sub { font-size: 0.8rem; color: var(--text-dim); } .temp-group { text-align: right; } .temp-main { font-size: 1.8rem; font-weight: 300; } .weather-icon { width: 40px; height: 40px; filter: grayscale(100%) contrast(1.2) brightness(1.2); object-fit: contain; } .card-summary { margin-top: 10px; font-size: 0.95rem; color: var(--text-mid); } .card-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.85rem; } .detail-item { display: flex; flex-direction: column; } .detail-label { color: var(--text-dim); font-size: 0.7rem; text-transform: uppercase; } .full-text { grid-column: 1 / -1; margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; font-style: italic; color: var(--text-mid); } .hidden { display: none !important; } .loader { text-align: center; padding: 20px; color: var(--text-mid); animation: pulse 1.5s infinite; } .error-box { background: rgba(255, 50, 50, 0.1); border: 1px solid rgba(255, 50, 50, 0.3); color: #ff8888; padding: 15px; border-radius: 12px; margin-top: 20px; } @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }</style></head><body><div class=\"app-container\"><div class=\"glass-panel\"><header><h1>SimpleWeather by ABN</h1></header><form id=\"weather-form\" onsubmit=\"handleSearch(event)\"><div class=\"search-box\"><input type=\"text\" id=\"zip-input\" placeholder=\"Zip Code\" pattern=\"[0-9]{5}\" inputmode=\"numeric\" required><button type=\"submit\" class=\"go-btn\">GO</button></div></form><div id=\"loader\" class=\"loader hidden\">CONTACTING NWS...</div><div id=\"error-msg\" class=\"error-box hidden\"></div></div><div id=\"results-panel\" class=\"glass-panel hidden\"><div id=\"location-info\"><div class=\"city-name\" id=\"display-city\">--</div><div class=\"coords\" id=\"display-coords\">--</div></div><div class=\"tabs\"><div class=\"tab active\" onclick=\"switchView('hourly', this)\">HOURLY</div><div class=\"tab\" onclick=\"switchView('daily', this)\">DAILY</div><div class=\"tab\" onclick=\"switchView('weekly', this)\">WEEKLY</div></div><div id=\"hourly-container\" class=\"weather-list\"></div><div id=\"daily-container\" class=\"weather-list hidden\"></div><div id=\"weekly-container\" class=\"weather-list hidden\"></div></div></div><script>let hourlyData = [], dailyData = []; async function handleSearch(e) { e.preventDefault(); const zip = document.getElementById('zip-input').value; const loader = document.getElementById('loader'); const errorBox = document.getElementById('error-msg'); const resultsPanel = document.getElementById('results-panel'); loader.classList.remove('hidden'); errorBox.classList.add('hidden'); resultsPanel.classList.add('hidden'); try { const geoRes = await fetch(`https://api.zippopotam.us/us/${zip}`); if (!geoRes.ok) throw new Error(\"Zip not found.\"); const geoData = await geoRes.json(); const place = geoData.places[0]; const lat = place.latitude, lon = place.longitude; const gridRes = await fetch(`https://api.weather.gov/points/${lat},${lon}`); if (!gridRes.ok) throw new Error(\"NWS unavailable.\"); const gridData = await gridRes.json(); const [hourlyRes, dailyRes] = await Promise.all([fetch(gridData.properties.forecastHourly), fetch(gridData.properties.forecast)]); const hourlyJson = await hourlyRes.json(); const dailyJson = await dailyRes.json(); hourlyData = hourlyJson.properties.periods; dailyData = dailyJson.properties.periods; document.getElementById('display-city').textContent = `${place['place name']}, ${place['state abbreviation']}`.toUpperCase(); document.getElementById('display-coords').textContent = `LAT: ${lat} // LON: ${lon}`; renderList(hourlyData.slice(0, 24), 'hourly-container'); renderList(dailyData.slice(0, 2), 'daily-container'); renderList(dailyData, 'weekly-container'); resultsPanel.classList.remove('hidden'); } catch (err) { errorBox.textContent = `ERROR: ${err.message}`; errorBox.classList.remove('hidden'); } finally { loader.classList.add('hidden'); } } function renderList(data, containerId) { const container = document.getElementById(containerId); container.innerHTML = data.map((item, index) => { const dateObj = new Date(item.startTime); const time = dateObj.toLocaleTimeString([], { hour: 'numeric' }); const day = dateObj.toLocaleDateString([], { weekday: 'short', month: 'numeric', day: 'numeric' }); const detailId = `${containerId}-detail-${index}`; return `<div class=\"card\" onclick=\"toggleDetails('${detailId}')\"><div class=\"card-header\"><div class=\"time-group\"><span class=\"time-main\">${containerId === 'hourly-container' ? time : item.name}</span><span class=\"time-sub\">${day}</span></div><img class=\"weather-icon\" src=\"${item.icon}\" alt=\"icon\"><div class=\"temp-group\"><span class=\"temp-main\">${item.temperature}°</span></div></div><div class=\"card-summary\">${item.shortForecast}</div><div id=\"${detailId}\" class=\"card-details hidden\"><div class=\"detail-item\"><span class=\"detail-label\">WIND</span><span>${item.windSpeed} ${item.windDirection}</span></div><div class=\"detail-item\"><span class=\"detail-label\">HUMIDITY</span><span>${item.relativeHumidity?.value ?? 0}%</span></div><div class=\"detail-item\"><span class=\"detail-label\">PRECIP</span><span>${item.probabilityOfPrecipitation?.value ?? 0}%</span></div><div class=\"detail-item\"><span class=\"detail-label\">DEWPOINT</span><span>${item.dewpoint?.value ? Math.round(item.dewpoint.value) : '--'}°C</span></div>${item.detailedForecast ? `<div class=\"full-text\">\"${item.detailedForecast}\"</div>` : ''}</div></div>`; }).join(''); } function toggleDetails(id) { document.getElementById(id).classList.toggle('hidden'); } function switchView(view, btn) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); btn.classList.add('active'); ['hourly', 'daily', 'weekly'].forEach(v => { document.getElementById(`${v}-container`).classList.toggle('hidden', v !== view); }); }</script></body></html>";
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {
            getWindow().getAttributes().layoutInDisplayCutoutMode = 
                WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES;
        }
        WebView webView = new WebView(this);
        webView.setWebViewClient(new WebViewClient());
        WebSettings settings = webView.getSettings();
        settings.setJavaScriptEnabled(true);
        settings.setDomStorageEnabled(true);
        settings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);
        String encodedHtml = Base64.encodeToString(html.getBytes(), Base64.NO_PADDING);
        webView.loadData(encodedHtml, "text/html", "base64");
        setContentView(webView);
    }
}
